<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Dashboard - VishnoRex</title>
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
    <link rel="shortcut icon" type="image/x-icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/applogo.png') }}">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/salary_management.css') }}">
    <style>
        /* OVERRIDE: Fix sidebar positioning for staff dashboard - Higher specificity */
        .container-fluid {
            padding: 0 !important;
            margin: 0 !important;
        }

        .row {
            margin: 0;
            height: fit-content !important;
            min-height: unset !important;
            display: flex;
            flex-wrap: nowrap;
        }

        /* FIXED SIDEBAR - Override external CSS */
        nav.enhanced-sidebar,
        .enhanced-sidebar {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 250px !important;
            height: 100vh !important;
            overflow-y: auto !important;
            overflow-x: hidden !important;
            z-index: 1000 !important;
            display: block !important;
            transform: translateX(0) !important;
            background: #221e66 !important;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1) !important;
        }

        /* MAIN CONTENT - Match sidebar width exactly */
        main.salary-main-content,
        .salary-main-content {
            margin-left: 250px !important;
            width: calc(100% - 250px) !important;
            min-height: 100vh;
            padding: 2rem 1rem !important;
            overflow-x: hidden;
        }

        /* Remove Bootstrap default spacing */
        .col-md-2,
        .col-md-10 {
            padding-left: 0 !important;
            padding-right: 0 !important;
        }

        /* MOBILE RESPONSIVE - Override external CSS */
        @media (max-width: 768px) {

            nav.enhanced-sidebar,
            .enhanced-sidebar {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 280px !important;
                height: 100vh !important;
                overflow-y: auto !important;
                transform: translateX(-100%) !important;
                transition: transform 0.3s ease !important;
                z-index: 1050 !important;
                display: block !important;
            }

            nav.enhanced-sidebar.show,
            .enhanced-sidebar.show {
                transform: translateX(0) !important;
            }

            main.salary-main-content,
            .salary-main-content {
                margin-left: 0 !important;
                width: 100% !important;
                padding: 1rem 0.5rem !important;
                padding-top: 4rem !important;
            }

            .sidebar-toggle {
                display: flex;
                align-items: center !important;
                justify-content: center !important;
                position: fixed !important;
                top: 1rem !important;
                left: 1rem !important;
                z-index: 1100 !important;
                background: #221e66 !important;
                color: white !important;
                border: none !important;
                border-radius: 0.5rem !important;
                padding: 0.75rem !important;
                font-size: 1.25rem !important;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2) !important;
                transition: all 0.3s ease, opacity 0.2s ease-in-out !important;
                cursor: pointer !important;
                opacity: 1;
            }

            .sidebar-toggle:hover {
                transform: translateY(-2px) !important;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3) !important;
                background: #221e66 !important;
            }
        }

        /* Show toggle button on mobile AND tablet/laptop views */
        @media (max-width: 1024px) {
            .sidebar-toggle {
                display: flex;
                align-items: center !important;
                justify-content: center !important;
            }
        }

        /* DESKTOP - Ensure sidebar is always visible and fixed */
        @media (min-width: 1025px) {

            nav.enhanced-sidebar,
            .enhanced-sidebar {
                position: fixed !important;
                display: block !important;
                transform: translateX(0) !important;
                width: 250px !important;
                height: 100vh !important;
            }

            .sidebar-toggle {
                display: none;
                opacity: 0;
            }
        }

        /* Ensure proper stacking and prevent layout shifts */
        body {
            overflow-x: hidden;
        }

        /* Force sidebar content to be properly positioned */
        .enhanced-sidebar .sidebar-header,
        .enhanced-sidebar .sidebar-content,
        .enhanced-sidebar .sidebar-footer {
            position: relative;
            z-index: 1;
        }

        /* Pay Slip Preview Styling */
        .pay-slip-preview {
            font-family: 'Inter', Arial, sans-serif;
            background: white;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .pay-slip-preview .card {
            border: 1px solid #e0e6ed;
            border-radius: 0.375rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .pay-slip-preview .card-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding: 0.75rem 1rem;
        }

        .pay-slip-preview .card-body p {
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .pay-slip-preview .d-flex {
            padding: 0.25rem 0;
            border-bottom: 1px solid #f1f3f4;
        }

        .pay-slip-preview .d-flex:last-child {
            border-bottom: none;
        }

        .pay-slip-preview hr {
            margin: 0.75rem 0;
            border-color: #dee2e6;
        }

        @media print {
            .pay-slip-preview {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }

        /* Spinning animation for refresh button */
        .spinning {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.6;
            }

            100% {
                opacity: 1;
            }
        }

        /* Enhanced attendance display styling */
        .attendance-time-display {
            padding: 0.5rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 0.375rem;
            border: 1px solid #dee2e6;
            min-height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .attendance-status-display {
            padding: 0.5rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 0.375rem;
            border: 1px solid #dee2e6;
            min-height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .time-value {
            font-size: 1.1rem;
            font-weight: 600;
            font-family: 'Courier New', monospace;
        }

        /* ================================================= */
        /* PAY SLIP MODAL RESPONSIVE DESIGN                 */
        /* ================================================= */

        /* Mobile First - Small devices (≤576px) */
        @media (max-width: 576px) {

            /* Modal sizing and positioning */
            #paySlipModal .modal-dialog {
                margin: 0.25rem !important;
                max-width: calc(100% - 0.5rem) !important;
                height: calc(100vh - 0.5rem) !important;
            }

            #paySlipModal .modal-content {
                height: 100% !important;
                border-radius: 0.5rem !important;
            }

            /* Modal header responsive */
            #paySlipModal .modal-header {
                padding: 0.75rem 1rem !important;
                border-bottom: 1px solid rgba(255, 255, 255, 0.2) !important;
            }

            #paySlipModal .modal-title {
                font-size: 1.1rem !important;
                font-weight: 600 !important;
            }

            /* Modal body responsive */
            #paySlipModal .modal-body {
                padding: 1rem !important;
                overflow-y: auto !important;
                overflow-x: visible !important;
                flex: 1 !important;
                width: 100% !important;
            }

            /* Ensure form container is properly sized */
            #paySlipModal #paySlipForm {
                width: 100% !important;
                display: block !important;
            }

            /* Alert responsive */
            #paySlipModal .alert {
                padding: 0.75rem !important;
                margin-bottom: 1rem !important;
                font-size: 0.875rem !important;
                line-height: 1.4 !important;
            }

            #paySlipModal .alert strong {
                display: block !important;
                margin-bottom: 0.25rem !important;
            }

            /* Form responsive - Stack columns */
            #paySlipModal .row {
                margin: 0 !important;
                --bs-gutter-x: 0 !important;
                display: flex !important;
                flex-direction: column !important;
                width: 100% !important;
            }

            #paySlipModal .col-md-6 {
                padding-left: 0 !important;
                padding-right: 0 !important;
                margin-bottom: 1rem !important;
                width: 100% !important;
                flex: 0 0 100% !important;
                max-width: 100% !important;
                display: block !important;
                position: relative !important;
            }

            /* Ensure both Year and Month fields are visible */
            #paySlipModal .col-md-6:nth-child(1),
            #paySlipModal .col-md-6:nth-child(2) {
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
            }

            /* Form elements responsive */
            #paySlipModal .form-label {
                font-size: 0.875rem !important;
                font-weight: 600 !important;
                margin-bottom: 0.5rem !important;
                color: #495057 !important;
                display: block !important;
                width: 100% !important;
            }

            #paySlipModal .mb-3 {
                margin-bottom: 1rem !important;
                width: 100% !important;
                display: block !important;
            }

            #paySlipModal .form-select {
                font-size: 0.875rem !important;
                padding: 0.75rem !important;
                height: auto !important;
                min-height: 44px !important;
                border-radius: 0.375rem !important;
                border: 1px solid #ced4da !important;
                background-size: 16px 12px !important;
                width: 100% !important;
                display: block !important;
                position: relative !important;
                z-index: 1 !important;
            }

            #paySlipModal .form-select:focus {
                border-color: #86b7fe !important;
                box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25) !important;
                z-index: 2 !important;
            }

            /* Preview section responsive */
            #paySlipModal #paySlipPreview {
                margin-top: 1rem !important;
                padding: 0.75rem !important;
                border-radius: 0.375rem !important;
            }

            #paySlipModal #paySlipPreview .row {
                flex-direction: column !important;
            }

            #paySlipModal #paySlipPreview .col-md-8,
            #paySlipModal #paySlipPreview .col-md-4 {
                margin-bottom: 0.5rem !important;
                text-align: left !important;
            }

            #paySlipModal #paySlipPreview .col-md-4:last-child {
                margin-bottom: 0 !important;
            }

            /* Card responsive */
            #paySlipModal .card {
                border-radius: 0.375rem !important;
                margin-top: 1rem !important;
            }

            #paySlipModal .card-body {
                padding: 0.75rem !important;
            }

            #paySlipModal .card-title {
                font-size: 0.9rem !important;
                margin-bottom: 0.75rem !important;
            }

            #paySlipModal .list-unstyled li {
                margin-bottom: 0.5rem !important;
                font-size: 0.825rem !important;
                line-height: 1.4 !important;
            }

            /* Modal footer responsive - Stack buttons */
            #paySlipModal .modal-footer {
                padding: 1rem !important;
                border-top: 1px solid #dee2e6 !important;
                flex-direction: column !important;
                gap: 0.75rem !important;
            }

            #paySlipModal .modal-footer .btn {
                width: 100% !important;
                padding: 0.75rem 1rem !important;
                font-size: 0.875rem !important;
                font-weight: 500 !important;
                border-radius: 0.375rem !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                gap: 0.5rem !important;
            }

            /* Button order for mobile UX */
            #paySlipModal .modal-footer .btn-info {
                order: 1 !important;
            }

            #paySlipModal .modal-footer .btn-success {
                order: 2 !important;
            }

            #paySlipModal .modal-footer .btn-secondary {
                order: 3 !important;
                margin-top: 0.5rem !important;
                background-color: white !important;
            }
        }

        /* Tablet - Medium devices (577px - 768px) */
        @media (min-width: 577px) and (max-width: 768px) {
            #paySlipModal .modal-dialog {
                margin: 1rem !important;
                max-width: calc(100% - 2rem) !important;
            }

            #paySlipModal .modal-body {
                padding: 1.25rem !important;
            }

            #paySlipModal .col-md-6 {
                margin-bottom: 1rem !important;
            }

            #paySlipModal .modal-footer {
                padding: 1rem 1.25rem !important;
                flex-direction: row !important;
                flex-wrap: wrap !important;
                gap: 0.5rem !important;
            }

            #paySlipModal .modal-footer .btn {
                flex: 1 1 auto !important;
                min-width: 120px !important;
                max-width: 200px !important;
            }

            #paySlipModal .modal-footer .btn-secondary {
                flex: 1 1 100% !important;
                margin-top: 0.5rem !important;
                order: 3 !important;
            }
        }

        /* Small Laptop - Large tablets (769px - 992px) */
        @media (min-width: 769px) and (max-width: 992px) {
            #paySlipModal .modal-dialog {
                max-width: 600px !important;
                margin: 1.75rem auto !important;
            }

            #paySlipModal .modal-body {
                padding: 1.5rem !important;
            }

            #paySlipModal .modal-footer {
                padding: 1rem 1.5rem !important;
                justify-content: flex-end !important;
                gap: 0.75rem !important;
            }

            #paySlipModal .modal-footer .btn {
                min-width: 140px !important;
                padding: 0.5rem 1rem !important;
            }
        }

        /* Large Laptop/Desktop (993px - 1199px) */
        @media (min-width: 993px) and (max-width: 1199px) {
            #paySlipModal .modal-dialog {
                max-width: 700px !important;
            }

            #paySlipModal .modal-footer .btn {
                min-width: 150px !important;
            }
        }

        /* Extra Large Desktop (≥1200px) */
        @media (min-width: 1200px) {
            #paySlipModal .modal-dialog {
                max-width: 800px !important;
            }

            #paySlipModal .modal-footer .btn {
                min-width: 160px !important;
            }
        }

        /* ================================================= */
        /* PAY SLIP PREVIEW MODAL RESPONSIVE DESIGN         */
        /* ================================================= */

        /* Mobile First - Small devices (≤576px) */
        @media (max-width: 576px) {
            #paySlipPreviewModal .modal-dialog {
                margin: 0 !important;
                max-width: 100% !important;
                height: 100vh !important;
            }

            #paySlipPreviewModal .modal-content {
                height: 100vh !important;
                border-radius: 0 !important;
            }

            #paySlipPreviewModal .modal-header {
                padding: 0.75rem 1rem !important;
            }

            #paySlipPreviewModal .modal-body {
                padding: 0.5rem !important;
                overflow-y: auto !important;
                flex: 1 !important;
            }

            #paySlipPreviewModal .modal-footer {
                padding: 0.75rem 1rem !important;
                flex-direction: column !important;
                gap: 0.5rem !important;
            }

            #paySlipPreviewModal .modal-footer .btn {
                width: 100% !important;
                padding: 0.75rem !important;
                font-size: 0.875rem !important;
            }

            /* Adjust pay slip preview content */
            .pay-slip-preview {
                padding: 0.75rem !important;
                font-size: 0.8rem !important;
                margin: 0 !important;
            }

            .pay-slip-preview .card-body {
                padding: 0.5rem !important;
            }

            .pay-slip-preview h6 {
                font-size: 0.9rem !important;
            }

            .pay-slip-preview .d-flex {
                flex-direction: column !important;
                align-items: flex-start !important;
                gap: 0.25rem !important;
            }
        }

        /* Tablet */
        @media (min-width: 577px) and (max-width: 768px) {
            #paySlipPreviewModal .modal-dialog {
                margin: 0.5rem !important;
                max-width: calc(100% - 1rem) !important;
            }

            .pay-slip-preview {
                font-size: 0.85rem !important;
                padding: 1rem !important;
            }
        }

        /* Laptop and above */
        @media (min-width: 769px) {
            #paySlipPreviewModal .modal-dialog {
                max-width: 90% !important;
            }
        }

        /* ================================================= */
        /* ADDITIONAL RESPONSIVE UTILITIES                   */
        /* ================================================= */

        /* Touch-friendly elements */
        @media (max-width: 768px) {
            .btn {
                min-height: 44px !important;
                touch-action: manipulation !important;
            }

            .form-select,
            .form-control {
                min-height: 44px !important;
                font-size: 16px !important;
                /* Prevents zoom on iOS */
            }
        }

        /* High DPI displays */
        @media (-webkit-min-device-pixel-ratio: 2),
        (min-resolution: 192dpi) {
            #paySlipModal .modal-content {
                border: 0.5px solid rgba(0, 0, 0, 0.125) !important;
                box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
            }
        }

        /* Landscape phone orientation */
        @media (max-width: 768px) and (orientation: landscape) {
            #paySlipModal .modal-dialog {
                height: calc(100vh - 1rem) !important;
                margin: 0.5rem !important;
            }

            #paySlipModal .modal-body {
                padding: 0.75rem !important;
            }

            #paySlipModal .modal-footer .btn {
                padding: 0.5rem 1rem !important;
                font-size: 0.8rem !important;
            }
        }
    </style>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/print.css') }}" media="print">
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#0d6efd">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="VishnoRex">
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/applogo.png') }}">
    <link rel="apple-touch-startup-image" href="{{ url_for('static', filename='images/applogo.png') }}">

</head>

<body>
    <!-- Intelligent Sidebar Toggle -->
    <button type="button" class="sidebar-toggle" id="sidebarToggle" title="Toggle sidebar menu" aria-expanded="false"
        aria-controls="enhanced-sidebar">
        <i class="bi bi-list"></i>
    </button>

    <div class="container-fluid">
        <div class="row">
            <!-- Enhanced Sidebar -->
            <nav class="col-md-2 enhanced-sidebar" id="enhanced-sidebar">
                <div class="sidebar-header">
                    <div class="brand-logo">
                        {% if institution.branding_enabled and institution.logo_path %}
                        <img src="/{{ institution.logo_path }}" alt="Institution Logo" class="institution-logo">
                        {% else %}
                        <div class="logo-icon">
                            <i class="bi bi-person-workspace"></i>
                        </div>
                        {% endif %}
                        <div class="brand-text">
                            {% if institution.branding_enabled and institution.name %}
                            <h6 class="brand-title">{{ institution.name }}</h6>
                            <small class="brand-subtitle">Staff Panel</small>
                            {% else %}
                            <h6 class="brand-title">VishnoRex</h6>
                            <small class="brand-subtitle">Staff Panel</small>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="sidebar-content">
                    <!-- User Profile Section -->
                    <div class="user-profile">
                        <div class="user-avatar">
                            <i class="bi bi-person-circle"></i>
                        </div>
                        <div class="user-info">
                            <div class="user-name">{{ session.get('full_name', 'Staff User') }}</div>
                            <div class="user-role">Staff Member</div>
                        </div>
                    </div>

                    <!-- Navigation Menu -->
                    <div class="nav-section">
                        <div class="nav-section-title">
                            <i class="bi bi-grid-3x3-gap"></i>
                            <span>Main Menu</span>
                        </div>
                        <ul class="nav-menu">
                            <li class="nav-item">
                                <a class="nav-link active" href="#">
                                    <div class="nav-icon">
                                        <i class="bi bi-house-door"></i>
                                    </div>
                                    <span class="nav-text">Dashboard</span>
                                    <div class="nav-indicator"></div>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('staff_profile_page') }}">
                                    <div class="nav-icon">
                                        <i class="bi bi-person"></i>
                                    </div>
                                    <span class="nav-text">My Profile</span>
                                    <div class="nav-indicator"></div>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" id="paySlipLink">
                                    <div class="nav-icon">
                                        <i class="bi bi-receipt"></i>
                                    </div>
                                    <span class="nav-text">Pay Slip</span>
                                    <div class="nav-indicator"></div>
                                </a>
                            </li>
                            {% if timetable_enabled %}
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('staff_timetable') }}">
                                    <div class="nav-icon">
                                        <i class="bi bi-calendar2-week"></i>
                                    </div>
                                    <span class="nav-text">My Timetable</span>
                                    <div class="nav-indicator"></div>
                                </a>
                            </li>
                            {% endif %}

                        </ul>
                    </div>

                    <!-- Applications Section -->
                    <!-- <div class="nav-section"> 
                        <div class="nav-section-title">
                            <i class="bi bi-file-earmark-text"></i>
                            <span>Applications</span>
                        </div>
                        <ul class="nav-menu">
                            <li class="nav-item">
                                <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#applyLeaveModal">
                                    <div class="nav-icon">
                                        <i class="bi bi-calendar-plus"></i>
                                    </div>
                                    <span class="nav-text">Apply Leave</span>
                                    <div class="nav-indicator"></div>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#applyOnDutyModal">
                                    <div class="nav-icon">
                                        <i class="bi bi-briefcase"></i>
                                    </div>
                                    <span class="nav-text">Apply On Duty</span>
                                    <div class="nav-indicator"></div>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#applyPermissionModal">
                                    <div class="nav-icon">
                                        <i class="bi bi-clock"></i>
                                    </div>
                                    <span class="nav-text">Apply Permission</span>
                                    <div class="nav-indicator"></div>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div> -->

                    <!-- Sidebar Footer -->
                    <div class="sidebar-footer">
                        <div class="footer-stats">
                            <div class="stat-item">
                                <i class="bi bi-calendar-day"></i>
                                <span id="currentDate">-</span>
                            </div>
                        </div>
                        <button type="button" class="logout-btn" onclick="logout()" title="Logout">
                            <i class="bi bi-box-arrow-right"></i>
                            <span>Logout</span>
                        </button>
                    </div>
            </nav>

            <!-- Main content -->
            <main class="col-md-10 ms-sm-auto px-md-4 salary-main-content">
                <!-- Enhanced Header -->
                <div class="salary-header">
                    <div class="header-content">
                        <div class="header-title">
                            <div class="title-icon">
                                <i class="bi bi-speedometer2"></i>
                            </div>
                            <div class="title-text">
                                <h1 class="main-title">Staff Dashboard</h1>
                                <p class="subtitle">Welcome back, {{ session.get('full_name', 'Staff User') }}! Track
                                    your attendance and manage applications</p>
                            </div>
                        </div>
                        <div class="header-actions">
                            <button type="button" class="btn btn-outline-primary" id="refreshDataBtn"
                                title="Refresh data">
                                <i class="bi bi-arrow-clockwise"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <!-- </div>
                            <i class="bi bi-person me-2"></i>My Profile</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('staff_change_password') }}">
                            <i class="bi bi-key me-2"></i>Change Password</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="{{ url_for('logout') }}">
                            <i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
                    </ul>
                </li> -->
                    <!-- CSRF Token for AJAX requests -->
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />

                    <!-- Today's Attendance Card -->
                    <div class="salary-filters-card">
                        <div class="card-header">
                            <div class="header-icon">
                                <i class="bi bi-calendar-check"></i>
                            </div>
                            <div class="header-content">
                                <h5 class="card-title">Today's Attendance</h5>
                                <p class="card-subtitle">{{ today.strftime('%d %b %Y') }} - Track your daily attendance
                                </p>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="filters-grid">
                                <div class="filter-group">
                                    <label class="form-label">
                                        <i class="bi bi-clock"></i> Check-in Time
                                    </label>
                                    <div class="attendance-time-display">
                                        <span class="time-value text-success" id="timeIn">--:--:--</span>
                                    </div>
                                </div>
                                <div class="filter-group">
                                    <label class="form-label">
                                        <i class="bi bi-clock-history"></i> Check-out Time
                                    </label>
                                    <div class="attendance-time-display">
                                        <span class="time-value text-info" id="timeOut">--:--:--</span>
                                    </div>
                                </div>
                                <div class="filter-group">
                                    <label class="form-label">
                                        <i class="bi bi-check-circle"></i> Status
                                    </label>
                                    <div class="attendance-status-display">
                                        <span class="badge bg-secondary" id="currentStatus">Not Marked</span>
                                    </div>
                                </div>
                                <div class="filter-group">
                                    <label class="form-label">
                                        <i class="bi bi-stopwatch"></i> Total Hours
                                    </label>
                                    <div class="attendance-time-display">
                                        <span class="time-value text-primary" id="totalHours">--:--</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- My Leave Applications -->
                    <div class="salary-results-card">
                        <div class="card-header">
                            <div class="header-icon">
                                <i class="bi bi-calendar-x"></i>
                            </div>
                            <div class="header-content">
                                <h5 class="card-title">My Leave Applications</h5>
                                <p class="card-subtitle">Track your leave requests and their status</p>
                            </div>
                            <div class="header-actions">
                                <div class="results-stats">
                                    <div class="stat-item">
                                        <i class="bi bi-file-earmark-text"></i>
                                        <span class="stat-value">{{ leaves|length }}</span>
                                        <span>Applications</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            {% if leaves %}
                            <div class="table-responsive">
                                <table class="table salary-results-table">
                                    <thead>
                                        <tr>
                                            <th>Leave Type</th>
                                            <th>Duration</th>
                                            <th>Reason</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for leave in leaves %}
                                        <tr>
                                            <td>
                                                <span class="badge bg-info">{{ leave.leave_type }}</span>
                                            </td>
                                            <td>
                                                <div>
                                                    <small class="d-block"><i class="bi bi-calendar-event"></i> {{
                                                        leave.start_date }}</small>
                                                    <small class="d-block"><i class="bi bi-calendar-event"></i> {{
                                                        leave.end_date }}</small>
                                                </div>
                                            </td>
                                            <td>{{ leave.reason }}</td>
                                            <td>
                                                {% if leave.status == 'approved' %}
                                                <span class="earnings-badge">Approved</span>
                                                {% elif leave.status == 'rejected' %}
                                                <span class="badge bg-danger">Rejected</span>
                                                {% else %}
                                                <span class="deductions-badge">Pending</span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <div class="empty-state">
                                <div class="empty-icon">
                                    <i class="bi bi-calendar-x"></i>
                                </div>
                                <h6 class="empty-title">No Leave Applications</h6>
                                <p class="empty-text">You haven't applied for any leave yet. Click "Apply Leave" to
                                    submit your first request.</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- My On Duty Applications -->
                    <div class="salary-results-card mb-4">
                        <div class="card-header">
                            <div class="header-icon">
                                <i class="bi bi-briefcase"></i>
                            </div>
                            <div class="header-content">
                                <h5 class="card-title">My On Duty Applications</h5>
                                <p class="card-subtitle">Your on-duty request history and status</p>
                            </div>
                            <div class="header-actions">
                                <!-- <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#applyOnDutyModal">
                            <i class="bi bi-plus"></i> Apply On Duty
                        </button> -->
                            </div>
                        </div>
                        <div class="card-body">
                            {% if on_duty_applications %}
                            <div class="table-responsive">
                                <table class="table salary-results-table">
                                    <thead>
                                        <tr>
                                            <th>Type</th>
                                            <th>From</th>
                                            <th>To</th>
                                            <th>Location</th>
                                            <th>Purpose</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for duty in on_duty_applications %}
                                        <tr>
                                            <td><span class="badge bg-success">{{ duty.duty_type }}</span></td>
                                            <td>{{ duty.start_date|dateformat if duty.start_date else '-' }}</td>
                                            <td>{{ duty.end_date|dateformat if duty.end_date else '-' }}</td>
                                            <td>{{ duty.location or '-' }}</td>
                                            <td>{{ duty.purpose[:30] }}{% if duty.purpose|length > 30 %}...{% endif %}
                                            </td>
                                            <td>
                                                {% if duty.status == 'approved' %}
                                                <span class="earnings-badge">Approved</span>
                                                {% elif duty.status == 'rejected' %}
                                                <span class="badge bg-danger">Rejected</span>
                                                {% else %}
                                                <span class="deductions-badge">Pending</span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <div class="empty-state">
                                <div class="empty-icon">
                                    <i class="bi bi-briefcase"></i>
                                </div>
                                <h6 class="empty-title">No On Duty Applications</h6>
                                <p class="empty-text">You haven't applied for any on-duty yet. Click "Apply On Duty" to
                                    submit your first request.</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- My Permission Applications -->
                    <div class="salary-results-card mb-4">
                        <div class="card-header">
                            <div class="header-icon">
                                <i class="bi bi-clock-history"></i>
                            </div>
                            <div class="header-content">
                                <h5 class="card-title">My Permission Applications</h5>
                                <p class="card-subtitle">Your permission request history and status</p>
                            </div>
                            <div class="header-actions">
                                <!-- <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#applyPermissionModal">
                            <i class="bi bi-plus"></i> Apply Permission
                        </button> -->
                            </div>
                        </div>
                        <div class="card-body">
                            {% if permission_applications %}
                            <div class="table-responsive">
                                <table class="table salary-results-table">
                                    <thead>
                                        <tr>
                                            <th>Type</th>
                                            <th>Date</th>
                                            <th>Time</th>
                                            <th>Duration</th>
                                            <th>Reason</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for permission in permission_applications %}
                                        <tr>
                                            <td><span class="badge bg-warning">{{ permission.permission_type }}</span>
                                            </td>
                                            <td>{{ permission.permission_date|dateformat if permission.permission_date
                                                else '-' }}</td>
                                            <td>{{ permission.start_time|timeformat }} - {{
                                                permission.end_time|timeformat }}</td>
                                            <td>{{ "%.1f"|format(permission.duration_hours) }} hrs</td>
                                            <td>{{ permission.reason[:30] }}{% if permission.reason|length > 30 %}...{%
                                                endif %}</td>
                                            <td>
                                                {% if permission.status == 'approved' %}
                                                <span class="earnings-badge">Approved</span>
                                                {% elif permission.status == 'rejected' %}
                                                <span class="badge bg-danger">Rejected</span>
                                                {% else %}
                                                <span class="deductions-badge">Pending</span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <div class="empty-state">
                                <div class="empty-icon">
                                    <i class="bi bi-clock-history"></i>
                                </div>
                                <h6 class="empty-title">No Permission Applications</h6>
                                <p class="empty-text">You haven't applied for any permission yet. Click "Apply
                                    Permission" to submit your first request.</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                </div>

                <!-- Right Column -->
                <!-- <div class="col-md-4">


            Today's Status Card
            <div class="card mb-4">
                <div class="card-header bg-info text-white">
                    <h5><i class="bi bi-calendar-day"></i> Today's Status</h5>
                </div>
                <div class="card-body text-center">
                    <div id="todayStatusDisplay">
                        <div class="mb-3">
                            <h3 id="todayStatusText" class="text-muted">Loading...</h3>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <div class="border rounded p-2">
                                    <small class="text-muted">Check-in</small>
                                    <div id="todayCheckIn" class="fw-bold">--:--</div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="border rounded p-2">
                                    <small class="text-muted">Check-out</small>
                                    <div id="todayCheckOut" class="fw-bold">--:--</div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <a href="{{ url_for('staff_profile_page') }}" class="btn btn-outline-info btn-sm">
                                <i class="bi bi-person"></i> View Full Profile
                            </a>
                        </div>
                    </div>
                </div>
            </div> -->

                <!-- Quick Actions -->
                <!-- <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5>Quick Actions</h5>
                </div>
                <div class="card-body">
                    <button type="button" class="btn btn-outline-primary w-100 mb-2" data-bs-toggle="modal" data-bs-target="#applyLeaveModal">
                        <i class="bi bi-calendar-plus"></i> Apply Leave
                    </button>
                    <button type="button" class="btn btn-outline-success w-100 mb-2" data-bs-toggle="modal" data-bs-target="#applyOnDutyModal">
                        <i class="bi bi-briefcase"></i> Apply On Duty
                    </button>
                    <button type="button" class="btn btn-outline-warning w-100 mb-2" data-bs-toggle="modal" data-bs-target="#applyPermissionModal">
                        <i class="bi bi-clock"></i> Apply Permission
                    </button>
                    <button type="button" class="btn btn-outline-secondary w-100" id="downloadReportBtn">
                        <i class="bi bi-file-earmark-text"></i> Download Report
                    </button>
                </div>
            </div> -->

                <!-- Attendance Summary -->
                <!-- <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5>Attendance Summary ({{ today.strftime('%B %Y') }})</h5>
                </div>
                <div class="card-body">
                    <canvas id="attendanceChart" width="100%" height="200"></canvas>
                    <div class="mt-3">
                        <p><span class="badge bg-success me-2">&nbsp;</span> Present: <span id="presentDays">0</span> days</p>
                        <p><span class="badge bg-danger me-2">&nbsp;</span> Absent: <span id="absentDays">0</span> days</p>
                        <p><span class="badge bg-warning me-2">&nbsp;</span> Late: <span id="lateDays">0</span> days</p>
                        <p><span class="badge me-2" style="background-color: #fd7e14;">&nbsp;</span> Left Soon: <span id="leftSoonDays">0</span> days</p>
                        <p><span class="badge bg-info me-2">&nbsp;</span> Leave: <span id="leaveDays">0</span> days</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> -->

                <!-- Apply Leave Modal -->
                <div class="modal fade" id="applyLeaveModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header bg-primary text-white">
                                <h5 class="modal-title">Apply for Leave</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <!-- Quota Balance Display -->
                                <div class="quota-balance-section mb-4" id="leaveQuotaBalance" style="display: none;">
                                    <h6 class="fw-bold text-primary mb-3">
                                        <i class="bi bi-bar-chart"></i> Your Leave Balance
                                    </h6>
                                    <div class="row" id="leaveBalanceCards">
                                        <!-- Leave balance cards will be populated here -->
                                    </div>
                                </div>

                                <form id="leaveForm">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                                    <div class="mb-3">
                                        <label for="leaveType" class="form-label">Leave Type</label>
                                        <select class="form-select" id="leaveType" required>
                                            <option value="" selected disabled>Select leave type</option>
                                            <option value="CL">Casual Leave (CL)</option>
                                            <option value="SL">Sick Leave (SL)</option>
                                            <option value="EL">Earned Leave (EL)</option>
                                            <option value="ML">Maternity Leave (ML)</option>
                                        </select>
                                        <div class="form-text" id="leaveTypeHelp">Select a leave type to see your
                                            remaining balance</div>
                                    </div>

                                    <!-- Selected Leave Type Balance -->
                                    <div class="alert alert-info" id="selectedLeaveBalance" style="display: none;">
                                        <i class="bi bi-info-circle"></i>
                                        <span id="selectedLeaveBalanceText">You have 0 days remaining for this leave
                                            type</span>
                                    </div>

                                    <div class="mb-3">
                                        <label for="startDate" class="form-label">Start Date</label>
                                        <input type="date" class="form-control" id="startDate" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="endDate" class="form-label">End Date</label>
                                        <input type="date" class="form-control" id="endDate" required>
                                        <div class="form-text" id="leaveDaysCalculated" style="display: none;">
                                            Total days: <span id="totalLeaveDays">0</span>
                                        </div>
                                    </div>

                                    <!-- Quota Validation Message -->
                                    <div class="alert alert-warning" id="leaveQuotaWarning" style="display: none;">
                                        <i class="bi bi-exclamation-triangle"></i>
                                        <span id="leaveQuotaWarningText">Your request exceeds available balance</span>
                                    </div>

                                    <div class="mb-3">
                                        <label for="leaveReason" class="form-label">Reason</label>
                                        <textarea class="form-control" id="leaveReason" rows="3" required></textarea>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary" id="submitLeave">Submit</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Apply On Duty Modal -->
                <div class="modal fade" id="applyOnDutyModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header bg-success text-white">
                                <h5 class="modal-title">Apply for On Duty</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <!-- OD Quota Balance Display -->
                                <div class="row mb-4">
                                    <div class="col-12">
                                        <div class="alert alert-info mb-3">
                                            <i class="fas fa-info-circle me-2"></i>
                                            <strong>On Duty Quota Information</strong>
                                        </div>
                                        <div class="row g-3">
                                            <div class="col-md-4">
                                                <div class="card border-primary">
                                                    <div class="card-body text-center">
                                                        <h6 class="card-title text-primary mb-1">
                                                            <i class="fas fa-calendar-plus me-1"></i>Allocated
                                                        </h6>
                                                        <h4 class="text-primary mb-0" id="odAllocatedQuota">-</h4>
                                                        <small class="text-muted">days/year</small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="card border-warning">
                                                    <div class="card-body text-center">
                                                        <h6 class="card-title text-warning mb-1">
                                                            <i class="fas fa-calendar-minus me-1"></i>Used
                                                        </h6>
                                                        <h4 class="text-warning mb-0" id="odUsedQuota">-</h4>
                                                        <small class="text-muted">days</small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="card border-success">
                                                    <div class="card-body text-center">
                                                        <h6 class="card-title text-success mb-1">
                                                            <i class="fas fa-calendar-check me-1"></i>Remaining
                                                        </h6>
                                                        <h4 class="text-success mb-0" id="odRemainingQuota">-</h4>
                                                        <small class="text-muted">days</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Application Validation Alert -->
                                <div id="odQuotaAlert" class="alert alert-warning d-none mb-3">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    <span id="odQuotaAlertText"></span>
                                </div>

                                <form id="onDutyForm">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="dutyType" class="form-label">Duty Type</label>
                                                <select class="form-select" id="dutyType" name="duty_type" required>
                                                    <option value="" selected disabled>Select duty type</option>
                                                    <option value="Official Work">Official Work</option>
                                                    <option value="Training">Training</option>
                                                    <option value="Meeting">Meeting</option>
                                                    <option value="Conference">Conference</option>
                                                    <option value="Field Work">Field Work</option>
                                                    <option value="Other">Other</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="dutyLocation" class="form-label">Location</label>
                                                <input type="text" class="form-control" id="dutyLocation"
                                                    name="location" placeholder="Enter location">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="dutyStartDate" class="form-label">Start Date</label>
                                                <input type="date" class="form-control" id="dutyStartDate"
                                                    name="start_date" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="dutyEndDate" class="form-label">End Date</label>
                                                <input type="date" class="form-control" id="dutyEndDate" name="end_date"
                                                    required>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Total Days Calculation -->
                                    <div class="row mb-3">
                                        <div class="col-12">
                                            <div class="alert alert-light border">
                                                <div class="row align-items-center">
                                                    <div class="col-md-8">
                                                        <strong>Total OD Days:</strong>
                                                        <span id="odTotalDays" class="badge bg-primary ms-2">0
                                                            days</span>
                                                    </div>
                                                    <div class="col-md-4 text-end">
                                                        <small class="text-muted">Remaining after this: <span
                                                                id="odRemainingAfter" class="fw-bold">-</span></small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="dutyStartTime" class="form-label">Start Time
                                                    (Optional)</label>
                                                <input type="time" class="form-control" id="dutyStartTime"
                                                    name="start_time">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="dutyEndTime" class="form-label">End Time (Optional)</label>
                                                <input type="time" class="form-control" id="dutyEndTime"
                                                    name="end_time">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="dutyPurpose" class="form-label">Purpose</label>
                                        <textarea class="form-control" id="dutyPurpose" name="purpose" rows="2" required
                                            placeholder="Brief description of the duty purpose"></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label for="dutyReason" class="form-label">Additional Details (Optional)</label>
                                        <textarea class="form-control" id="dutyReason" name="reason" rows="2"
                                            placeholder="Any additional information"></textarea>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-success" id="submitOnDuty">Submit
                                    Application</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Apply Permission Modal -->
                <div class="modal fade" id="applyPermissionModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header bg-warning text-dark">
                                <h5 class="modal-title">Apply for Permission</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <!-- Permission Quota Balance Display -->
                                <div class="row mb-4">
                                    <div class="col-12">
                                        <div class="alert alert-info mb-3">
                                            <i class="fas fa-info-circle me-2"></i>
                                            <strong>Permission Quota Information</strong>
                                        </div>
                                        <div class="row g-3">
                                            <div class="col-md-4">
                                                <div class="card border-primary">
                                                    <div class="card-body text-center">
                                                        <h6 class="card-title text-primary mb-1">
                                                            <i class="fas fa-clock me-1"></i>Allocated
                                                        </h6>
                                                        <h4 class="text-primary mb-0" id="permissionAllocatedQuota">-
                                                        </h4>
                                                        <small class="text-muted">hours/year</small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="card border-warning">
                                                    <div class="card-body text-center">
                                                        <h6 class="card-title text-warning mb-1">
                                                            <i class="fas fa-clock me-1"></i>Used
                                                        </h6>
                                                        <h4 class="text-warning mb-0" id="permissionUsedQuota">-</h4>
                                                        <small class="text-muted">hours</small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="card border-success">
                                                    <div class="card-body text-center">
                                                        <h6 class="card-title text-success mb-1">
                                                            <i class="fas fa-clock me-1"></i>Remaining
                                                        </h6>
                                                        <h4 class="text-success mb-0" id="permissionRemainingQuota">-
                                                        </h4>
                                                        <small class="text-muted">hours</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Application Validation Alert -->
                                <div id="permissionQuotaAlert" class="alert alert-warning d-none mb-3">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    <span id="permissionQuotaAlertText"></span>
                                </div>

                                <form id="permissionForm">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                                    <div class="mb-3">
                                        <label for="permissionType" class="form-label">Permission Type</label>
                                        <select class="form-select" id="permissionType" name="permission_type" required>
                                            <option value="" selected disabled>Select permission type</option>
                                            <option value="Personal Work">Personal Work</option>
                                            <option value="Medical">Medical</option>
                                            <option value="Emergency">Emergency</option>
                                            <option value="Family Function">Family Function</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="permissionDate" class="form-label">Date</label>
                                        <input type="date" class="form-control" id="permissionDate"
                                            name="permission_date" required>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="permissionStartTime" class="form-label">Start Time</label>
                                                <input type="time" class="form-control" id="permissionStartTime"
                                                    name="start_time" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="permissionEndTime" class="form-label">End Time</label>
                                                <input type="time" class="form-control" id="permissionEndTime"
                                                    name="end_time" required>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Total Hours Calculation -->
                                    <div class="row mb-3">
                                        <div class="col-12">
                                            <div class="alert alert-light border">
                                                <div class="row align-items-center">
                                                    <div class="col-md-8">
                                                        <strong>Total Permission Hours:</strong>
                                                        <span id="permissionTotalHours" class="badge bg-warning ms-2">0
                                                            hours</span>
                                                    </div>
                                                    <div class="col-md-4 text-end">
                                                        <small class="text-muted">Remaining after this: <span
                                                                id="permissionRemainingAfter"
                                                                class="fw-bold">-</span></small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="permissionReason" class="form-label">Reason</label>
                                        <textarea class="form-control" id="permissionReason" name="reason" rows="3"
                                            required
                                            placeholder="Please provide detailed reason for permission"></textarea>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-warning" id="submitPermission">Submit
                                    Application</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pay Slip Modal -->
                <div class="modal fade" id="paySlipModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header bg-success text-white">
                                <h5 class="modal-title">
                                    <i class="bi bi-receipt"></i> Download Pay Slip
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="alert alert-info mb-4 d-flex align-items-start">
                                    <i class="bi bi-info-circle me-2 mt-1 flex-shrink-0"></i>
                                    <div>
                                        <strong class="d-block mb-1">Your Pay Slip Access</strong>
                                        <span class="small">Download your salary slip for any month. Please select the
                                            year and month below.</span>
                                    </div>
                                </div>

                                <form id="paySlipForm">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                                    <div class="row g-3">
                                        <div class="col-md-6 col-12">
                                            <div class="mb-3">
                                                <label for="paySlipYear" class="form-label fw-semibold">
                                                    <i class="bi bi-calendar-event me-1 text-primary"></i>Year
                                                </label>
                                                <select class="form-select form-select-lg" id="paySlipYear" name="year"
                                                    required>
                                                    <option value="" selected disabled>Select year</option>
                                                    <!-- Years will be populated by JavaScript -->
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-12">
                                            <div class="mb-3">
                                                <label for="paySlipMonth" class="form-label fw-semibold">
                                                    <i class="bi bi-calendar-month me-1 text-primary"></i>Month
                                                </label>
                                                <select class="form-select form-select-lg" id="paySlipMonth"
                                                    name="month" required>
                                                    <option value="" selected disabled>Select month</option>
                                                    <option value="1">January</option>
                                                    <option value="2">February</option>
                                                    <option value="3">March</option>
                                                    <option value="4">April</option>
                                                    <option value="5">May</option>
                                                    <option value="6">June</option>
                                                    <option value="7">July</option>
                                                    <option value="8">August</option>
                                                    <option value="9">September</option>
                                                    <option value="10">October</option>
                                                    <option value="11">November</option>
                                                    <option value="12">December</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Pay Slip Preview Information -->
                                    <div class="alert alert-light border border-success" id="paySlipPreview"
                                        style="display: none;">
                                        <div class="row g-2 align-items-start align-items-md-center">
                                            <div class="col-md-8 col-12">
                                                <div
                                                    class="d-flex flex-column flex-sm-row align-items-start align-items-sm-center">
                                                    <strong class="me-2 mb-1 mb-sm-0 text-success">
                                                        <i class="bi bi-receipt me-1"></i>Pay Slip:
                                                    </strong>
                                                    <span id="paySlipPeriod" class="badge bg-success fs-6">-</span>
                                                </div>
                                            </div>
                                            <div class="col-md-4 col-12 text-start text-md-end">
                                                <small
                                                    class="text-muted d-flex align-items-center justify-content-start justify-content-md-end">
                                                    <i class="bi bi-person-badge me-1"></i>
                                                    Staff ID: <span id="paySlipStaffId" class="fw-bold ms-1">{{
                                                        staff_info.staff_id if staff_info else '-' }}</span>
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </form>

                                <div class="card mt-3 border-success shadow-sm">
                                    <div class="card-body p-3">
                                        <h6 class="card-title text-success d-flex align-items-center mb-3">
                                            <i class="bi bi-download me-2"></i>
                                            <span>Download Instructions</span>
                                        </h6>
                                        <div class="instructions-list">
                                            <div class="instruction-item d-flex align-items-start mb-2">
                                                <i class="bi bi-check-circle text-success me-2 mt-1 flex-shrink-0"></i>
                                                <span class="small">Select the year and month for your pay slip</span>
                                            </div>
                                            <div class="instruction-item d-flex align-items-start mb-2">
                                                <i class="bi bi-check-circle text-success me-2 mt-1 flex-shrink-0"></i>
                                                <span class="small">Click "Download Pay Slip" to generate PDF</span>
                                            </div>
                                            <div class="instruction-item d-flex align-items-start">
                                                <i class="bi bi-check-circle text-success me-2 mt-1 flex-shrink-0"></i>
                                                <span class="small">Your pay slip will be downloaded
                                                    automatically</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer d-flex justify-content-end gap-2">
                                <button type="button" class="btn btn-info d-flex align-items-center" id="previewPaySlip"
                                    disabled>
                                    <i class="bi bi-eye me-2"></i>
                                    <span class="d-none d-sm-inline">Preview Pay Slip</span>
                                    <span class="d-sm-none">Preview</span>
                                </button>
                                <button type="button" class="btn btn-success d-flex align-items-center"
                                    id="downloadPaySlip" disabled>
                                    <i class="bi bi-download me-2"></i>
                                    <span class="d-none d-sm-inline">Download Pay Slip</span>
                                    <span class="d-sm-none">Download</span>
                                </button>
                                <button type="button" class="btn btn-secondary d-flex align-items-center"
                                    data-bs-dismiss="modal">
                                    <i class="bi bi-x-circle me-2"></i>
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pay Slip Preview Modal -->
                <div class="modal fade" id="paySlipPreviewModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header bg-info text-white">
                                <h5 class="modal-title">
                                    <i class="bi bi-eye"></i> Pay Slip Preview
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div id="paySlipPreviewContent">
                                    <!-- Preview content will be loaded here -->
                                </div>
                            </div>
                            <div class="modal-footer d-flex justify-content-end gap-2">
                                <button type="button" class="btn btn-success d-flex align-items-center"
                                    id="downloadFromPreview">
                                    <i class="bi bi-download me-2"></i>
                                    <span class="d-none d-sm-inline">Download This Pay Slip</span>
                                    <span class="d-sm-none">Download</span>
                                </button>
                                <button type="button" class="btn btn-secondary d-flex align-items-center"
                                    data-bs-dismiss="modal">
                                    <i class="bi bi-x-circle me-2"></i>
                                    Close
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
                <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

                <script>
                    // Set current staff ID for JavaScript access
                    window.currentStaffId = '{{ staff_info.staff_id if staff_info else "" }}';
                    window.staffDbId = '{{ session.get("user_id", "") }}';

                    // Pay Slip Modal Functionality
                    document.addEventListener('DOMContentLoaded', function () {
                        // Pay slip modal elements
                        const paySlipLink = document.getElementById('paySlipLink');
                        const paySlipModal = new bootstrap.Modal(document.getElementById('paySlipModal'));
                        const paySlipPreviewModal = new bootstrap.Modal(document.getElementById('paySlipPreviewModal'));
                        const paySlipYear = document.getElementById('paySlipYear');
                        const paySlipMonth = document.getElementById('paySlipMonth');
                        const paySlipPreview = document.getElementById('paySlipPreview');
                        const paySlipPeriod = document.getElementById('paySlipPeriod');
                        const previewPaySlipBtn = document.getElementById('previewPaySlip');
                        const downloadPaySlipBtn = document.getElementById('downloadPaySlip');
                        const paySlipPreviewContent = document.getElementById('paySlipPreviewContent');
                        const downloadFromPreviewBtn = document.getElementById('downloadFromPreview');

                        // Populate years (current year and past 5 years)
                        const currentYear = new Date().getFullYear();
                        for (let year = currentYear; year >= currentYear - 5; year--) {
                            const option = document.createElement('option');
                            option.value = year;
                            option.textContent = year;
                            paySlipYear.appendChild(option);
                        }

                        // Open pay slip modal
                        if (paySlipLink) {
                            paySlipLink.addEventListener('click', function (e) {
                                e.preventDefault();
                                paySlipModal.show();
                            });
                        }

                        // Update preview when year/month changes
                        function updatePaySlipPreview() {
                            const year = paySlipYear.value;
                            const month = paySlipMonth.value;

                            if (year && month) {
                                const monthNames = [
                                    'January', 'February', 'March', 'April', 'May', 'June',
                                    'July', 'August', 'September', 'October', 'November', 'December'
                                ];
                                const monthName = monthNames[parseInt(month) - 1];
                                paySlipPeriod.textContent = `${monthName} ${year}`;
                                paySlipPreview.style.display = 'block';
                                previewPaySlipBtn.disabled = false;
                                downloadPaySlipBtn.disabled = false;
                            } else {
                                paySlipPreview.style.display = 'none';
                                previewPaySlipBtn.disabled = true;
                                downloadPaySlipBtn.disabled = true;
                            }
                        }

                        paySlipYear.addEventListener('change', updatePaySlipPreview);
                        paySlipMonth.addEventListener('change', updatePaySlipPreview);

                        // Preview pay slip
                        previewPaySlipBtn.addEventListener('click', function () {
                            const year = paySlipYear.value;
                            const month = paySlipMonth.value;

                            if (!year || !month) {
                                showAlert('Please select both year and month', 'warning');
                                return;
                            }

                            previewStaffPaySlip(year, month);
                        });

                        // Download pay slip
                        downloadPaySlipBtn.addEventListener('click', function () {
                            const year = paySlipYear.value;
                            const month = paySlipMonth.value;

                            if (!year || !month) {
                                showAlert('Please select both year and month', 'warning');
                                return;
                            }

                            downloadStaffPaySlip(year, month);
                        });

                        // Download from preview
                        downloadFromPreviewBtn.addEventListener('click', function () {
                            const year = paySlipYear.value;
                            const month = paySlipMonth.value;

                            if (!year || !month) {
                                showAlert('Please select both year and month', 'warning');
                                return;
                            }

                            downloadStaffPaySlip(year, month);
                            paySlipPreviewModal.hide();
                        });

                        // Function to preview staff pay slip
                        function previewStaffPaySlip(year, month) {
                            showAlert('<i class="bi bi-eye me-2"></i>Loading pay slip preview...', 'info');

                            const formData = new FormData();
                            formData.append('year', year);
                            formData.append('month', month);
                            formData.append('csrf_token', document.querySelector('input[name="csrf_token"]').value);

                            fetch('/staff/preview_pay_slip', {
                                method: 'POST',
                                body: formData
                            })
                                .then(response => {
                                    if (response.ok) {
                                        return response.json();
                                    } else {
                                        return response.json().then(err => Promise.reject(err));
                                    }
                                })
                                .then(data => {
                                    if (data.success) {
                                        displayPaySlipPreview(data.data, year, month);
                                        paySlipModal.hide();
                                        paySlipPreviewModal.show();
                                        showAlert('<i class="bi bi-check-circle me-2"></i>Pay slip preview loaded successfully', 'success');
                                    } else {
                                        showAlert(`<i class="bi bi-exclamation-triangle me-2"></i>${data.error}`, 'danger');
                                    }
                                })
                                .catch(error => {
                                    console.error('Error previewing pay slip:', error);
                                    const errorMessage = error.error || error.message || 'Error loading pay slip preview. Please try again.';
                                    showAlert(`<i class="bi bi-exclamation-triangle me-2"></i>${errorMessage}`, 'danger');
                                });
                        }

                        // Function to display pay slip preview
                        function displayPaySlipPreview(salaryData, year, month) {
                            const monthNames = [
                                'January', 'February', 'March', 'April', 'May', 'June',
                                'July', 'August', 'September', 'October', 'November', 'December'
                            ];
                            const monthName = monthNames[parseInt(month) - 1];

                            const staff = salaryData.staff_info;
                            const breakdown = salaryData.salary_details;
                            const earnings = breakdown.earnings;
                            const deductions = breakdown.deductions;
                            const attendance = breakdown.attendance_summary;

                            const previewHTML = `
                <div class="pay-slip-preview">
                    <!-- Header -->
                    <div class="text-center mb-4">
                        <h4 class="fw-bold text-primary">VishnoRex Staff Management System</h4>
                        <h5 class="text-secondary">Pay Slip for ${monthName} ${year}</h5>
                        <hr>
                    </div>
                    
                    <!-- Staff Information -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card border-primary">
                                <div class="card-header bg-primary text-white">
                                    <h6 class="mb-0"><i class="bi bi-person"></i> Employee Information</h6>
                                </div>
                                <div class="card-body">
                                    <p><strong>Staff ID:</strong> ${staff.staff_id}</p>
                                    <p><strong>Name:</strong> ${staff.full_name}</p>
                                    <p><strong>Department:</strong> ${staff.department || 'N/A'}</p>
                                    <p><strong>Position:</strong> ${staff.position || 'N/A'}</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card border-info">
                                <div class="card-header bg-info text-white">
                                    <h6 class="mb-0"><i class="bi bi-calendar"></i> Pay Period</h6>
                                </div>
                                <div class="card-body">
                                    <p><strong>Month:</strong> ${monthName}</p>
                                    <p><strong>Year:</strong> ${year}</p>
                                    <p><strong>Working Days:</strong> ${breakdown.working_days || 'N/A'}</p>
                                    <p><strong>Days Present:</strong> ${attendance.present_days || 'N/A'}</p>
                                    <p><strong>Days Absent:</strong> ${attendance.absent_days || 0}</p>
                                    <p><strong>Leave Days:</strong> ${attendance.leave_days || 0}</p>
                                    ${attendance.on_duty_days > 0 ? `<p><strong>On Duty Days:</strong> ${attendance.on_duty_days}</p>` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Salary Details -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card border-success">
                                <div class="card-header bg-success text-white">
                                    <h6 class="mb-0"><i class="bi bi-plus-circle"></i> Earnings</h6>
                                </div>
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <span>Basic Salary:</span>
                                        <span class="fw-bold">₹${(earnings.basic_salary || 0).toFixed(2)}</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span>HRA:</span>
                                        <span class="fw-bold">₹${(earnings.hra || 0).toFixed(2)}</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span>Transport Allowance:</span>
                                        <span class="fw-bold">₹${(earnings.transport_allowance || 0).toFixed(2)}</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span>Other Allowances:</span>
                                        <span class="fw-bold">₹${(earnings.other_allowances || 0).toFixed(2)}</span>
                                    </div>
                                    ${earnings.early_arrival_bonus > 0 ? `
                                    <div class="d-flex justify-content-between">
                                        <span>Early Arrival Bonus:</span>
                                        <span class="fw-bold text-success">₹${earnings.early_arrival_bonus.toFixed(2)}</span>
                                    </div>` : ''}
                                    ${earnings.overtime_pay > 0 ? `
                                    <div class="d-flex justify-content-between">
                                        <span>Overtime Pay:</span>
                                        <span class="fw-bold text-success">₹${earnings.overtime_pay.toFixed(2)}</span>
                                    </div>` : ''}
                                    <hr>
                                    <div class="d-flex justify-content-between fw-bold text-success">
                                        <span>Total Earnings:</span>
                                        <span>₹${(earnings.total_earnings || 0).toFixed(2)}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card border-danger">
                                <div class="card-header bg-danger text-white">
                                    <h6 class="mb-0"><i class="bi bi-dash-circle"></i> Deductions</h6>
                                </div>
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <span>PF Deduction:</span>
                                        <span class="fw-bold">₹${(deductions.pf_deduction || 0).toFixed(2)}</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span>ESI Deduction:</span>
                                        <span class="fw-bold">₹${(deductions.esi_deduction || 0).toFixed(2)}</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span>Professional Tax:</span>
                                        <span class="fw-bold">₹${(deductions.professional_tax || 0).toFixed(2)}</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span>Other Deductions:</span>
                                        <span class="fw-bold">₹${(deductions.other_deductions || 0).toFixed(2)}</span>
                                    </div>
                                    ${deductions.absent_deduction > 0 ? `
                                    <div class="d-flex justify-content-between">
                                        <span>Absent Day Deduction:</span>
                                        <span class="fw-bold text-warning">₹${deductions.absent_deduction.toFixed(2)}</span>
                                    </div>` : ''}
                                    ${deductions.late_arrival_penalty > 0 ? `
                                    <div class="d-flex justify-content-between">
                                        <span>Late Arrival Penalty:</span>
                                        <span class="fw-bold text-warning">₹${deductions.late_arrival_penalty.toFixed(2)}</span>
                                    </div>` : ''}
                                    ${deductions.early_departure_penalty > 0 ? `
                                    <div class="d-flex justify-content-between">
                                        <span>Early Departure Penalty:</span>
                                        <span class="fw-bold text-warning">₹${deductions.early_departure_penalty.toFixed(2)}</span>
                                    </div>` : ''}
                                    <hr>
                                    <div class="d-flex justify-content-between fw-bold text-danger">
                                        <span>Total Deductions:</span>
                                        <span>₹${(deductions.total_deductions || 0).toFixed(2)}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Net Salary -->
                    <div class="row">
                        <div class="col-12">
                            <div class="card border-primary bg-light">
                                <div class="card-body text-center">
                                    <h4 class="text-primary mb-3">
                                        <i class="bi bi-currency-rupee"></i> Net Salary
                                    </h4>
                                    <h2 class="display-4 fw-bold text-primary">
                                        ₹${(breakdown.net_salary || 0).toFixed(2)}
                                    </h2>
                                    <p class="text-muted">
                                        <small>Amount payable for ${monthName} ${year}</small>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Footer -->
                    <div class="text-center mt-4">
                        <hr>
                        <p class="text-muted">
                            <small>This is a computer-generated pay slip. Generated on ${new Date().toLocaleDateString()}</small>
                        </p>
                    </div>
                </div>
            `;

                            paySlipPreviewContent.innerHTML = previewHTML;
                        }

                        // Function to download staff pay slip
                        function downloadStaffPaySlip(year, month) {
                            showAlert('<i class="bi bi-download me-2"></i>Generating your pay slip...', 'info');

                            const formData = new FormData();
                            formData.append('year', year);
                            formData.append('month', month);
                            formData.append('csrf_token', document.querySelector('input[name="csrf_token"]').value);

                            fetch('/staff/download_pay_slip', {
                                method: 'POST',
                                body: formData
                            })
                                .then(response => {
                                    if (response.ok) {
                                        return response.blob();
                                    } else {
                                        return response.json().then(err => Promise.reject(err));
                                    }
                                })
                                .then(blob => {
                                    // Create download link
                                    const url = window.URL.createObjectURL(blob);
                                    const a = document.createElement('a');
                                    a.style.display = 'none';
                                    a.href = url;
                                    a.download = `pay_slip_${window.currentStaffId}_${year}_${month.toString().padStart(2, '0')}.pdf`;
                                    document.body.appendChild(a);
                                    a.click();
                                    window.URL.revokeObjectURL(url);
                                    document.body.removeChild(a);

                                    showAlert('<i class="bi bi-check-circle me-2"></i>Pay slip downloaded successfully', 'success');
                                    paySlipModal.hide();
                                })
                                .catch(error => {
                                    console.error('Error downloading pay slip:', error);
                                    const errorMessage = error.error || error.message || 'Error downloading pay slip. Please try again.';
                                    showAlert(`<i class="bi bi-exclamation-triangle me-2"></i>${errorMessage}`, 'danger');
                                });
                        }

                        // Alert function
                        function showAlert(message, type = 'info') {
                            // Create alert element
                            const alertDiv = document.createElement('div');
                            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
                            alertDiv.style.cssText = 'top: 1rem; right: 1rem; z-index: 9999; min-width: 300px;';
                            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

                            document.body.appendChild(alertDiv);

                            // Auto remove after 5 seconds
                            setTimeout(() => {
                                if (alertDiv.parentNode) {
                                    alertDiv.remove();
                                }
                            }, 5000);
                        }
                    });

                    // Mobile sidebar toggle functionality
                    document.addEventListener('DOMContentLoaded', function () {
                        const sidebarToggle = document.getElementById('sidebarToggle');
                        const sidebar = document.getElementById('enhanced-sidebar');

                        // Show sidebar on desktop by default
                        function updateSidebarVisibility() {
                            if (window.innerWidth > 768) {
                                sidebar.style.display = 'block';
                                sidebar.classList.remove('show');
                            } else {
                                sidebar.style.display = 'block'; // Make sure it's not hidden by inline style
                            }
                        }

                        // Initial setup
                        updateSidebarVisibility();

                        let sidebarVisible = false;

                        // Intelligent toggle sidebar function
                        function toggleSidebar() {
                            if (sidebarVisible) {
                                // Hide sidebar
                                sidebar.classList.remove('show');
                                sidebarVisible = false;

                                // Keep toggle button as hamburger menu and make it reappear
                                sidebarToggle.innerHTML = '<i class="bi bi-list"></i>';
                                sidebarToggle.setAttribute('aria-expanded', 'false');
                                sidebarToggle.setAttribute('title', 'Show sidebar menu');

                                // Intelligent button reappearing - show toggle button when sidebar closes
                                setTimeout(() => {
                                    sidebarToggle.style.setProperty('display', 'flex', 'important');
                                    sidebarToggle.style.setProperty('opacity', '1', 'important');
                                }, 100);

                                console.log('✅ Sidebar closed, toggle button reappeared');
                            } else {
                                // Show sidebar
                                sidebar.classList.add('show');
                                sidebarVisible = true;

                                // Don't change icon to X, just hide the button completely for clean UI
                                sidebarToggle.setAttribute('aria-expanded', 'true');

                                console.log('✅ Sidebar opened, starting intelligent button hiding...');

                                // Intelligent button hiding - hide toggle button completely when sidebar opens
                                setTimeout(() => {
                                    sidebarToggle.style.setProperty('opacity', '0', 'important');
                                    setTimeout(() => {
                                        sidebarToggle.style.setProperty('display', 'none', 'important');
                                        console.log('✅ Toggle button completely hidden for clean interface');
                                    }, 200);
                                }, 300); // Reduced delay for faster hiding
                            }
                        }

                        if (sidebarToggle && sidebar) {
                            sidebarToggle.addEventListener('click', function (e) {
                                e.preventDefault();
                                console.log('Staff Dashboard - Toggle button clicked, screen width:', window.innerWidth);

                                // Only allow toggle on mobile/tablet/laptop screens
                                if (window.innerWidth <= 1024) {
                                    toggleSidebar();
                                } else {
                                    console.log('Toggle disabled on desktop screens');
                                }
                            });

                            // Close sidebar when clicking outside on mobile/tablet
                            document.addEventListener('click', function (event) {
                                if (window.innerWidth <= 1024 && sidebarVisible) {
                                    const isClickInsideSidebar = sidebar.contains(event.target);
                                    const isClickOnToggle = sidebarToggle.contains(event.target);

                                    if (!isClickInsideSidebar && !isClickOnToggle) {
                                        // Close sidebar and intelligently show toggle button
                                        sidebar.classList.remove('show');
                                        sidebarVisible = false;

                                        // Reset toggle button to hamburger menu and make it reappear
                                        sidebarToggle.innerHTML = '<i class="bi bi-list"></i>';
                                        sidebarToggle.setAttribute('aria-expanded', 'false');
                                        sidebarToggle.setAttribute('title', 'Show sidebar menu');

                                        // Intelligent button reappearing
                                        setTimeout(() => {
                                            sidebarToggle.style.setProperty('display', 'flex', 'important');
                                            sidebarToggle.style.setProperty('opacity', '1', 'important');
                                        }, 100);

                                        console.log('✅ Outside click: sidebar closed, toggle button reappeared');
                                    }
                                }
                            });

                            // Handle window resize
                            window.addEventListener('resize', function () {
                                updateSidebarVisibility();

                                if (window.innerWidth > 1024) {
                                    // Desktop: reset sidebar and toggle button state
                                    sidebar.classList.remove('show');
                                    sidebarVisible = false;
                                    sidebarToggle.innerHTML = '<i class="bi bi-list"></i>';
                                    sidebarToggle.setAttribute('aria-expanded', 'false');
                                    sidebarToggle.setAttribute('title', 'Show sidebar menu');

                                    // Reset toggle button visibility for desktop
                                    sidebarToggle.style.setProperty('display', 'none', 'important');
                                    sidebarToggle.style.setProperty('opacity', '0', 'important');

                                    console.log('Desktop mode - toggle hidden, sidebar always visible');
                                } else {
                                    // Mobile/Tablet/Laptop: ensure toggle button is visible when sidebar is closed
                                    if (!sidebarVisible) {
                                        sidebarToggle.style.setProperty('display', 'flex', 'important');
                                        sidebarToggle.style.setProperty('opacity', '1', 'important');
                                    }
                                    console.log('Mobile/Tablet mode - toggle behavior active');
                                }
                            });

                            // Initialize toggle button visibility on page load
                            if (window.innerWidth <= 1024) {
                                sidebarToggle.style.setProperty('display', 'flex', 'important');
                                sidebarToggle.style.setProperty('opacity', '1', 'important');
                                sidebarVisible = false;
                                console.log('Initial state: toggle visible, sidebar hidden for mobile/tablet');
                            } else {
                                sidebarToggle.style.setProperty('display', 'none', 'important');
                                sidebarToggle.style.setProperty('opacity', '0', 'important');
                                sidebarVisible = false;
                                console.log('Initial state: desktop mode, toggle hidden');
                            }
                        }
                    });

                    // Logout function for staff dashboard
                    function logout() {
                        if (confirm('Are you sure you want to logout?')) {
                            // Show loading state
                            const logoutBtn = document.querySelector('.logout-btn');
                            if (logoutBtn) {
                                logoutBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> <span>Logging out...</span>';
                                logoutBtn.disabled = true;
                            }

                            // Redirect to logout route
                            window.location.href = '/logout';
                        }
                    }

                    // Make logout function globally available
                    window.logout = logout;
                </script>
                <script src="{{ url_for('static', filename='js/staff_dashboard.js') }}"></script>

                <script>
                    // Register Service Worker for PWA
                    if ('serviceWorker' in navigator) {
                        window.addEventListener('load', () => {
                            navigator.serviceWorker.register("{{ url_for('static', filename='sw.js') }}")
                                .then(reg => console.log('Service Worker registered'))
                                .catch(err => console.log('Service Worker registration failed:', err));
                        });
                    }
                </script>
</body>

</html>